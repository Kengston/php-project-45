#!/usr/bin/env php
<?php

require_once __DIR__ . '/../../vendor/autoload.php';

use BrainGames\Cli;
use function cli\line;
use function cli\prompt;

function generateProgression(int $start, int $diff, int $length): array {
    $progression = [];
    for ($i = 0; $i < $length; $i++) {
        $progression[] = $start + $diff * $i;
    }
    return $progression;
}

function runProgressionGame(string $name): void {
    line('What number is missing in the progression?');

    $numCount = 3;
    $progressionLength = 10;

    for ($i = 0; $i < $numCount; $i++) {
        $start = rand(1, 20);
        $diff = rand(1, 10);
        $progression = generateProgression($start, $diff, $progressionLength);
        $hiddenIndex = array_rand($progression);
        $realAnswer = $progression[$hiddenIndex];
        $progression[$hiddenIndex] = '..';

        $question = implode(' ', $progression);
        line("Question: {$question}");
        $userAnswer = (int) prompt('Your answer');

        if ($userAnswer !== $realAnswer) {
            line("'{$userAnswer}' is wrong answer ;(. Correct answer was '{$realAnswer}'.");
            line("Let's try again, {$name}!");
            return;
        }

        line('Correct!');
    }

    line("Congratulations, {$name}!");
}

$name = Cli\welcomeUser();
runProgressionGame($name);